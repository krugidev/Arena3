<!-- Cabe√ßalho b√°sico com meta tags e link ao CSS -->
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" type="text/css" href="../css/eventosreserva.css" /> 
  <title>Arena 360 ‚Äî Reserva de Evento</title>

</head>
<body>

  <!--CONTEUDO-->
  
    <!-- Bot√£o para abrir o menu lateral (sidebar) em mobile -->
    <button id="toggle-menu" class="menu-btn">‚ò∞</button>

    
    <!-- Sidebar com as modalidades (UFC, WWE, PBR) e op√ß√µes de navega√ß√£o -->
    <div class="sidebar" id="sidebar">

      
      <a href="../html/homepage.html">
        <img src="../icons/image-removebg-preview (11).png" style="margin-left: 6%; list-style-type: none;">
      </a>
        <div class="divider"></div>

        <ul class="menu" style="list-style-type: none;">
          <li><img src="../icons/2560px-UFC_Logo.svg.png" class="icon"><strong></strong>
            <ul>
              <!-- As fun√ß√µes onclick abaixo guardam a modalidade escolhida no localStorage (o mesmo se aplica a todas as 3 modalidades) -->
              <li><a href="../html/reservabilhetesteste.html" onclick="selecionarModalidade('UFC')">Reservar Bilhetes</a></li>
              <li><a href="../html/lutadoresatletasdefteste.html" onclick="definirModalidade('UFC')">Lutadores</a></li>
              <li><a href="../html/resultadosteste.html">Resultados</a></li>
              <li><a href="../html/noticias.html">Not√≠cias</a></li>
            </ul>
          </li>
          <li><img src="../icons/WWE_Logo.svg.png" class="icon"><strong></strong>
            <ul>
              <li><a href="../html/reservabilhetesteste.html" onclick="selecionarModalidade('WWE')">Reservar Bilhetes</a></li>
              <li><a href="../html/lutadoresatletasdefteste.html" onclick="definirModalidade('WWE')">Lutadores</a></li>
              <li><a href="../html/resultadosteste.html">Resultados</a></li>
              <li><a href="../html/noticias.html">Not√≠cias</a></li>
            </ul>
          </li>
          <li><img src="../icons/Professional_Bull_Riders_logo.png" class="icon"><strong></strong>
            <ul>
              <li><a href="../html/reservabilhetesteste.html" onclick="selecionarModalidade('PBR')">Reservar Bilhetes</a></li>
              <li><a href="../html/lutadoresatletasdefteste.html" onclick="definirModalidade('PBR')">Atletas</a></li>
              <li><a href="../html/resultadosteste.html">Resultados</a></li>
              <li><a href="../html/noticias.html">Not√≠cias</a></li>
            </ul>
          </li>
          <li><strong>Lojas Oficiais</strong>
          
            <ul>
              <li><a href="../html/testesotres.html">Lojas</a></li>
            </ul>
          </li>
        </ul>
      </div>





  <!-- T√≠tulo principal da p√°gina -->
  <h1>RESERVA DE BILHETES</h1>
    
  <!-- In√≠cio do container principal da p√°gina -->
  <div class="page-container">


    <!-- Contador regressivo para o in√≠cio do evento (atualizado em JS) -->
    <div id="countdown" class="countdown">
        <p>Come√ßa em:</p>
        <span id="timer">12d 06h 23m</span>
      </div>
      

    <!-- Arena Visual -->
    <div>
  <!-- Ilustra√ß√£o circular da arena com tr√™s an√©is -->
  <div class="arena-wrapper">
    <div class="ring ring1"></div> <!-- Anel 1 -->
    <div class="ring ring2"></div> <!-- Anel 2 -->
    <div class="ring ring3"></div> <!-- Anel 3 -->
    <div class="ringue">RING</div> <!-- Centro (tipo depende da modalidade) -->
  </div>

<!-- Legenda visual com as cores dos lugares -->
<div class="legend">
  <span><div class="box available"></div>Dispon√≠vel</span>
  <span><div class="box premium"></div>Premium</span>
  <span><div class="box occupied"></div>Ocupado</span>
</div>

    </div>

    <!-- Painel de filtros (sele√ß√£o de anel e lugar espec√≠fico) + resumo de lugares dispon√≠veis -->
    <div class="filters-panel">
      <div class="event-info info-evento">
        <!-- Os dados do evento selecionado ser√£o preenchidos via JS -->
      </div>

      <div class="divider"></div>

      <h2>Filtrar Lugares</h2>

      <!-- Dropdown para sele√ß√£o de anel -->
      <label for="anel">Anel</label>
      <select id="anel">
        <option value="ring1">Anel 1</option>
        <option value="ring2">Anel 2</option>
        <option value="ring3">Anel 3</option>
      </select>

      <!-- Campo para escrever n√∫mero do lugar -->
      <label for="lugar">Lugar</label>
      <input type="text" id="lugar" style="width: 95%;" placeholder="Digite n√∫mero do lugar"/>


      <!-- Bot√£o para reservar lugar -->
      <button class="reserve-btn">Confirmar Reserva</button>


      <!-- Visualiza√ß√£o atual de lugares dispon√≠veis -->
      <div class="available-spots">
        <span><strong>Anel 1:</strong> 40 dispon√≠veis</span>
        <span><strong>Anel 2:</strong> 35 dispon√≠veis</span>
        <span><strong>Anel 3:</strong> 20 dispon√≠veis</span>
      </div>
    </div>

  </div>


  <footer class="footer">
    <div class="footer-container">
      <div class="footer-section">
        <h3>Arena 360</h3>
        <p>&copy; 2025 ‚Äî Todos os direitos reservados.</p>
      </div>
      
      <div class="footer-section">
        <h4>Links</h4>
        <ul>
          <li><a href="#">Pol√≠tica de Privacidade</a></li>
          <li><a href="#">Termos de Uso</a></li>
          <li><a href="#">FAQ</a></li>
          <li><a href="#">Suporte</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>Contactos</h4>
        <p>üìß suporte@arena360.com</p>
        <p>üìû +351 912 345 678</p>
      </div>
      
      <div class="footer-section">
        <h4>Segue-nos</h4>
        <div class="social-icons">
          <a href="#"><img src="../icons/instagram-new--v2.png" alt="Instagram"></a>
          <a href="#"><img src="../icons/twitterx--v2.png" alt="Twitter"></a>
          <a href="#"><img src="../icons/youtube-play.png" alt="YouTube"></a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Pop-up: Resumo da reserva antes de confirmar -->
  <div id="resumoPopup" class="popup hidden">
    <div class="popup-content">
      <span class="close-btn" onclick="fecharPopup()">&times;</span>
      <h2>Resumo da Reserva</h2>
      <p><strong>Anel:</strong> Anel 2</p>
      <p><strong>Lugar:</strong> 15B</p>
      <p><strong>Pre√ßo:</strong> ‚Ç¨120</p>

      <!-- Confirmar pagamento chama a fun√ß√£o `finalizarReserva()` -->
      <button class="confirm-btn" onclick="mostrarSucesso()">Finalizar Pagamento</button>
    </div>
  </div>
  

  <!-- Pop-up: Mensagem de sucesso -->
  <div id="sucessoPopup" class="popup hidden">
    <div class="popup-content sucesso">
      <h2>‚úÖ Compra Confirmada!</h2>
      <p>O teu lugar est√° garantido.</p>

      <!-- Redireciona para a p√°gina de reservas que atualizar√° com a reserva mais recente feita ap√≥s a compra dos bilhetes -->
      <button class="confirm-btn">Ver Reservas</button>
    </div>
  </div>

</body>

<script>

//DISPONIBILIDADE DE LUGARES 'BASE', DEPENDENDO DO NOME DA ARENA ASSOCIADA AO EVENTO PREVIAMENTE SELECIONADO:
const capacidadePorArena = {
  "T-Mobile Arena": { ring1: 40, ring2: 35, ring3: 20 },
  "O2 Arena": { ring1: 30, ring2: 25, ring3: 15 },
  "Saitama Super Arena": { ring1: 50, ring2: 40, ring3: 30 },
  "Kigali Arena": { ring1: 25, ring2: 20, ring3: 15 },
  "Gin√°sio do Ibirapuera": { ring1: 20, ring2: 18, ring3: 12 },
  "Qudos Bank Arena": { ring1: 30, ring2: 25, ring3: 20 }
};


//A quantidade de lugares disponiveis √© INTERVALADA de modo a adaptar a cor do texto que indica a disponibilidade de lugares por anel numa arena.
function getClassByQuantidade(valor) {
  if (valor >= 30) return 'disponivel-alta';
  if (valor >= 15) return 'disponivel-media';
  if (valor >= 1) return 'disponivel-baixa';
  return 'disponivel-zero';
}


//Cores para ajustar aos an√©is interativos.
function obterCorPorQuantidade(valor) {
  if (valor >= 30) return 'green';
  if (valor >= 15) return 'orange';
  if (valor >= 1) return 'red';
  return 'gray';
}

let evento = null;
let capacidadeAtual = {};
let idEvento = "";

//OBTER EVENTO SELECIONADO//
// Ao carregar a p√°gina, ler os dados do evento guardado no localStorage
document.addEventListener("DOMContentLoaded", () => {
  evento = JSON.parse(localStorage.getItem("eventoSelecionado"));
  
  if (!evento) return;

  idEvento = evento.nome.replace(/\s+/g, "_").toLowerCase();


  capacidadeAtual = JSON.parse(localStorage.getItem("lugares_" + idEvento));
  if (!capacidadeAtual) {
    capacidadeAtual = capacidadePorArena[evento.arena];
    localStorage.setItem("lugares_" + idEvento, JSON.stringify(capacidadeAtual));
  }


  // Info no topo
  document.querySelector(".event-info").innerHTML = `
    <h3>${evento.nome}</h3>
    <p><strong>Data:</strong> ${evento.data} ‚Äî ${evento.cidade}</p>
    <p><strong>Arena:</strong> ${evento.arena}</p>
  `;


  const ringue = document.querySelector(".ringue");


// Configura√ß√£o do ringue central (texto e formato visual) dependendo da modalidade
switch (evento.modalidade) {
  case "UFC":
    ringue.innerHTML = "RING";
    ringue.style.fontSize = "1.2em";
    ringue.style.borderRadius = "10%";
    break;
  case "WWE":
    ringue.innerHTML = "RING";
    ringue.style.fontSize = "1.2em";
    ringue.style.borderRadius = "0"; // quadrado
    break;
  case "PBR":
    ringue.innerHTML = "ARENA";
    ringue.style.fontSize = "1.1em";
    ringue.style.borderRadius = "50%";
    break;
  default:
    ringue.innerHTML = "EVENTO";
}


  atualizarCapacidadesUI();


  //INICIAR O COUNTDOWN
  iniciarCountdown(evento.data);


  //Aneis INTERATIVOS
let anelSelecionado = null;

// Eventos de hover, click e sincroniza√ß√£o dos an√©is com o dropdown
document.querySelectorAll(".ring").forEach(ring => {
  const id = ring.classList[1]; // ring1, ring2, ring3

  ring.addEventListener("mouseenter", () => {
    if (anelSelecionado === id) return;
    const quantidade = capacidadeAtual[id];
    ring.style.backgroundColor = obterCorPorQuantidade(quantidade);
    ring.style.opacity = "0.7";
    ring.style.cursor = "pointer";
  });

  ring.addEventListener("mouseleave", () => {
    if (anelSelecionado === id) return;
    ring.style.backgroundColor = "";
    ring.style.opacity = "1";
  });

  ring.addEventListener("click", () => {
    if (anelSelecionado) {
      document.querySelector(`.${anelSelecionado}`).style.backgroundColor = "";
    }

    anelSelecionado = id;
    const quantidade = capacidadeAtual[id];
    ring.style.backgroundColor = obterCorPorQuantidade(quantidade);
    ring.style.opacity = "1";

    document.getElementById("anel").value = id;
  });
});

});




//SICRONIZAR O ANEL INTERATIVO SELECIONADO COM O DROPDOWN
document.getElementById("anel").addEventListener("change", (e) => {
  const id = e.target.value;

  if (anelSelecionado) {
    document.querySelector(`.${anelSelecionado}`).style.backgroundColor = "";
  }

  anelSelecionado = id;

  const ring = document.querySelector(`.${id}`);
  const quantidade = capacidadeAtual[id];
  ring.style.backgroundColor = obterCorPorQuantidade(quantidade);
});


// Atualiza o texto que mostra os lugares dispon√≠veis para cada anel
function atualizarCapacidadesUI() {
  const container = document.querySelector(".available-spots");
  container.innerHTML = "";
  for (const [anel, valor] of Object.entries(capacidadeAtual)) {
    container.innerHTML += `
      <span class="${getClassByQuantidade(valor)}">
        <strong>${anel.replace("ring", "Anel ")}:</strong> ${valor} dispon√≠veis
      </span><br>
    `;
  }
}



// Abre o popup de resumo da reserva
function abrirResumo(anel, lugar, preco) {
  const popup = document.querySelector("#resumoPopup .popup-content");
  popup.innerHTML = `
    <span class="close-btn" onclick="fecharPopup()">&times;</span>
    <h2>Resumo da Reserva</h2>
    <p><strong>Anel:</strong> ${anel.replace("ring", "Anel ")}</p>
    <p><strong>Lugar:</strong> ${lugar}</p>
    <p><strong>Pre√ßo:</strong> ‚Ç¨${preco}</p>
    <button id="btn-finalizar-pagamento" class="confirm-btn">Finalizar Pagamento</button>
  `;

  document.getElementById('btn-finalizar-pagamento').addEventListener('click', () => {
   finalizarReserva(anel, lugar, preco);
  });

  document.getElementById('resumoPopup').classList.remove('hidden');
}



// Fecha o popup de resumo
  function fecharPopup() {
   document.getElementById('resumoPopup').classList.add('hidden');
  }



// Finaliza a reserva e guarda no localStorage associando-a ao utilizador que est√° atualmente logado.
  function finalizarReserva(anel, lugar, preco) {
    console.log("Finalizar reserva chamada ‚úÖ");

  const user = JSON.parse(localStorage.getItem("userLogado"));
  if (!user) {
    alert("√â necess√°rio estar loggado!");
    return;
  }



  //Estrutura do objeto de uma nova reserva.
  const novaReserva = {
  nome: evento.nome,
  data: evento.data,
  cidade: evento.cidade,
  arena: evento.arena,
  anel,
  lugar,
  preco,
  modalidade: evento.modalidade,
  email: user.email  // ‚Üê ISTO √â ESSENCIAL para associar uma reserva ao utilizador logado via email que est√° registado na sua conta.
};

console.log("Reserva a guardar:", novaReserva);


  const reservas = JSON.parse(localStorage.getItem("reservas")) || [];
  reservas.push(novaReserva);
  localStorage.setItem("reservas", JSON.stringify(reservas));


    // Atualizar capacidade
    capacidadeAtual[anel] = capacidadeAtual[anel] - 1;
  localStorage.setItem("lugares_" + idEvento, JSON.stringify(capacidadeAtual));
  atualizarCapacidadesUI();

  document.getElementById('resumoPopup').classList.add('hidden');
  document.getElementById('sucessoPopup').classList.remove('hidden');
 }


// Quando clica em "Ver Reservas", redireciona para a p√°gina de reservas
 document.querySelector('#sucessoPopup .confirm-btn').addEventListener('click', () => {
   window.location.href = "reservas.html";
 });


// Clique em Confirmar Reserva
document.querySelector('.reserve-btn').addEventListener('click', () => {
  const anel = document.getElementById("anel").value;
  const lugar = document.getElementById("lugar").value.trim();

  if (!lugar) {
    alert("Insere o n√∫mero do lugar!");
    return;
  }

  if (capacidadeAtual[anel] <= 0) {
    alert("Este anel est√° sem lugares dispon√≠veis.");
    return;
  }

  const preco = anel === "ring1" ? 150 : anel === "ring2" ? 120 : 90;
  abrirResumo(anel, lugar, preco);
});




//COUNTDOWN REGRESSIVO PARA O EVENTO
// Fun√ß√£o de contador regressivo com base na data do evento

function iniciarCountdown(dataEventoStr) {
  const timerEl = document.getElementById("timer");
  const partes = dataEventoStr.split("/"); // Esperado: "DD/MM/YYYY"
  const dataEvento = new Date(`${partes[2]}-${partes[1]}-${partes[0]}T00:00:00`);

  function atualizarCountdown() {
    const agora = new Date();
    const diff = dataEvento - agora;

    if (diff <= 0) {
      timerEl.textContent = "Evento j√° come√ßou!";
      return;
    }

    const dias = Math.floor(diff / (1000 * 60 * 60 * 24));
    const horas = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const minutos = Math.floor((diff / (1000 * 60)) % 60);
    const segundos = Math.floor((diff / 1000) % 60);

    timerEl.textContent = `${dias}d ${String(horas).padStart(2, '0')}h ${String(minutos).padStart(2, '0')}m ${String(segundos).padStart(2, '0')}s`;
  }

  atualizarCountdown();
  setInterval(atualizarCountdown, 1000); // Atualiza a cada segundo
}






// SIDEBAR
const toggleBtn = document.getElementById('toggle-menu');
const sidebar = document.getElementById('sidebar');
toggleBtn.addEventListener('click', () => {
  sidebar.classList.toggle('active');
});
document.querySelectorAll('.sidebar a').forEach(link => {
  link.addEventListener('click', () => {
    sidebar.classList.remove('active');
  });
});


//P√°gina de sele√ß√£o de eventos.
function selecionarModalidade(modalidade) {
  localStorage.setItem("modalidadeSelecionada", modalidade);
}

function definirModalidade(modalidade) {
  localStorage.setItem("modalidadeSelecionada", modalidade);
}
  </script>
  
</html>
