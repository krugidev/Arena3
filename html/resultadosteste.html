<!-- ESTRUTURA BASE -->
<!DOCTYPE html>
<html lang="pt">
<head>
  <!-- METADADOS -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/resultados.css" /> 
  <title>Resultados | Arena 360</title>
</head>
<body>

    <!-- BOT√ÉO MENU BURGER PARA MOBILE -->
    <button id="toggle-menu" class="menu-btn">‚ò∞</button>


    <!-- SIDEBAR NAVEGA√á√ÉO -->
    <div class="sidebar" id="sidebar">
      
      <a href="../html/homepage.html">
        <img src="../icons/image-removebg-preview (11).png" style="margin-left: 6%; list-style-type: none;">
      </a>
        <div class="divider"></div>
  
        <ul class="menu" style="list-style-type: none;">

          <!-- Cada item representa uma modalidade com submenus -->
          <!-- onClick guarda no localStorage qual foi a modalidade selecionada para passar esse valor para as diversas p√°ginas -->
          <li><img src="../icons/2560px-UFC_Logo.svg.png" class="icon"><strong></strong>
            <ul>
              <li><a href="../html/reservabilhetesteste.html" onclick="selecionarModalidade('UFC')">Reservar Bilhetes</a></li>
              <li><a href="../html/lutadoresatletasdefteste.html" onclick="definirModalidade('UFC')">Lutadores</a></li>
              <li><a href="../html/resultadosteste.html">Resultados</a></li>
              <li><a href="../html/noticias.html">Not√≠cias</a></li>
            </ul>
          </li>
          <li><img src="../icons/WWE_Logo.svg.png" class="icon"><strong></strong>
            <ul>
              <li><a href="../html/reservabilhetesteste.html" onclick="selecionarModalidade('WWE')">Reservar Bilhetes</a></li>
              <li><a href="../html/lutadoresatletasdefteste.html" onclick="definirModalidade('WWE')">Lutadores</a></li>
              <li><a href="../html/resultadosteste.html">Resultados</a></li>
              <li><a href="../html/noticias.html">Not√≠cias</a></li>
            </ul>
          </li>
          <li><img src="../icons/Professional_Bull_Riders_logo.png" class="icon"><strong></strong>
            <ul>
              <li><a href="../html/reservabilhetesteste.html" onclick="selecionarModalidade('PBR')">Reservar Bilhetes</a></li>
              <li><a href="../html/lutadoresatletasdefteste.html" onclick="definirModalidade('PBR')">Atletas</a></li>
              <li><a href="../html/resultadosteste.html">Resultados</a></li>
              <li><a href="../html/noticias.html">Not√≠cias</a></li>
            </ul>
          </li>
          <li><strong>Lojas Oficiais</strong>
          
            <ul>
              <li><a href="../html/testesotres.html">Lojas</a></li>
            </ul>
          </li>
        </ul>
      </div>
  

<!-- CONTE√öDO PRINCIPAL -->
<div class="main-content">
      <h1>RESULTADOS</h1>

       <!-- TABS PARA ESCOLHER MODALIDADE para filtrar os eventos. Cada um chama a fun√ß√£o de obter os resultados (cards de resultados a exibir), mas filtrados de acordo com a modalidade selecionada no filtro-->
      <div class="tabs">
        <button class="tab-btn active" onclick="mostrarResultados('ufc', this)">
          <img src="../icons/2560px-UFC_Logo.svg.png" alt="UFC" style="width: 20px; height: 10px;"> UFC
        </button>
        <button class="tab-btn" onclick="mostrarResultados('wwe', this)">
          <img src="../icons/WWE_Logo.svg.png" alt="WWE"> WWE
        </button>
        <button class="tab-btn" onclick="mostrarResultados('pbr', this)">
          <img src="../icons/Professional_Bull_Riders_logo.png" alt="PBR"> PBR
        </button>
      </div>
    


      <!-- CONTAINERS DE RESULTADOS POR MODALIDADE -->
      <div class="resultados-container" id="ufc"></div>
      <div class="resultados-container" id="wwe" style="display:none"></div>
      <div class="resultados-container" id="pbr" style="display:none"></div>
    

      <!-- MENSAGEM QUANDO N√ÉO H√Å RESULTADOS A SEREM EXIBIDOS-->
      <div id="mensagem-sem-resultados" style="display: none; text-align: center; margin-top: 30px; color: #aaa; font-size: 1.2em;">
        Atualmente n√£o existem resultados dispon√≠veis para esta modalidade.
      </div>
      

  <!-- POPUP DOS RESULTADOS DO EVENTO -->
  <div id="popupResultados" class="popup hidden">
    <div class="popup-content">
      <span class="close-btn" onclick="fecharPopup()">&times;</span>
      <h2 id="tituloEvento"></h2>
      <div id="combatesContainer" class="combates-grid"></div>
    </div>
  </div>
</div>


</div>



    <!------------ FOOTER ----------------------------------->


    <footer class="footer">
        <div class="footer-container">
          <div class="footer-section">
            <h3>Arena 360</h3>
            <p>&copy; 2025 ‚Äî Todos os direitos reservados.</p>
          </div>
          
          <div class="footer-section">
            <h4>Links</h4>
            <ul>
              <li><a href="#">Pol√≠tica de Privacidade</a></li>
              <li><a href="#">Termos de Uso</a></li>
              <li><a href="#">FAQ</a></li>
              <li><a href="#">Suporte</a></li>
            </ul>
          </div>
          
          <div class="footer-section">
            <h4>Contactos</h4>
            <p>üìß suporte@arena360.com</p>
            <p>üìû +351 912 345 678</p>
          </div>
          
          <div class="footer-section">
            <h4>Segue-nos</h4>
            <div class="social-icons">
              <a href="#"><img src="../icons/instagram-new--v2.png" alt="Instagram"></a>
              <a href="#"><img src="../icons/twitterx--v2.png" alt="Twitter"></a>
              <a href="#"><img src="../icons/youtube-play.png" alt="YouTube"></a>
            </div>
          </div>
        </div>
      </footer>


      
      <!-- Popup de Coment√°rios -->
<div id="popupComentarios" class="popup hidden">
  <div class="popup-content">

    <!--BOT√ÉO PARA FECHAR O POPUP DE COMENT√ÅRIOS-->
    <span class="close-btn" onclick="fecharComentarios()">&times;</span>
    <h2 id="tituloComentarios">Coment√°rios</h2>
    <div id="lista-comentarios" class="comentarios-container"></div>  
    <textarea id="novo-comentario" placeholder="Escreve o teu coment√°rio..."></textarea>

    <div class="emoji-wrapper">
      <button onclick="publicarComentario()">Publicar</button>
      <!--BOT√ÉO PARA ABRIR A DIV DA SELE√á√ÉO DE EMOJIS-->
      <button id="toggle-emoji" title="Emojis">üòÄ</button>
      <div id="emoji-popup" class="emoji-popup hidden">
        <!--EMOJIS DISPONIVEIS PARA UTILIZAR-->
        <span>üòç</span><span>üòé</span><span>üòÇ</span><span>üëç</span><span>üëé</span>
        <span>üî•</span><span>üíØ</span><span>ü§Ø</span><span>üéØ</span><span>ü§°</span>
      </div>
    </div>
    
  </div>
</div>


  <script>





//ARRAY DE RESULTADOS (QUE SE CRUZAR√Å COM O ARRAY DE EVENTOS, PARA ASSOCIAR V√ÅRIOS RESULTADOS A UM EVENTO)
const resultadosMock = [
  {
    nomeEvento: "WrestleMania 41",
    modalidade: "WWE",
    data: "02/04/2025",
    cidade: "New York",
    arena: "MSG Arena",
    combates: [
      {
        vencedor: "Cody Rhodes",
        derrotado: "Roman Reigns",
        metodo: "Pin",
        imagem: "CODY_04262024gd_0100_headSawp_(1)--9614b63ab3bbb8c9bedcfac02908b9d0.png"
      }
    ]
  },
  {
    nomeEvento: "UFC 300",
    modalidade: "UFC",
    data: "10/05/2025",
    cidade: "Las Vegas",
    arena: "T-Mobile Arena",
    combates: [
      {
        vencedor: "Jon Jones",
        derrotado: "Ciryl Gane",
        metodo: "TKO (1¬∫ round)",
        imagem: "jonjones.png"
      }
    ]
  }
];



// ARMAZENA OS RESULTADOS NO LOCALSTORAGE
localStorage.setItem("resultados", JSON.stringify(resultadosMock));



    document.addEventListener("DOMContentLoaded", () => {

      // L√ä RESULTADOS E PREENCHE OS CARDS POR MODALIDADE
      const resultados = JSON.parse(localStorage.getItem("resultados")) || [];
      const hoje = new Date();

      const ufcDiv = document.getElementById("ufc");
      const wweDiv = document.getElementById("wwe");
      const pbrDiv = document.getElementById("pbr");

      resultados.forEach(evento => {
        const [dia, mes, ano] = evento.data.split("/");
        const dataEvento = new Date(`${ano}-${mes}-${dia}`);
        if (dataEvento > hoje) return; //VERIFICAR SE O EVENTO J√Å OCORREU PARA QUE POSSA EXIBIR OS SEUS RESULTADOS.

        //SE O EVENTO J√Å TIVER OCORRIDO, √â CONSTRUIDO UM CARD PARA ELE..ATUALIZANDO AS INFOS.
        const card = document.createElement("div");
        card.className = "evento-card";
        card.innerHTML = `
          <h3>${evento.nomeEvento}</h3>
          <p>${evento.data} ‚Äî ${evento.cidade}</p>
          <button onclick="abrirResultados('${evento.nomeEvento.replace(/'/g, "\\'")}')">Ver Resultados</button>
          <button onclick="abrirComentarios('${encodeURIComponent(evento.nomeEvento)}')">Ver Coment√°rios</button>
        `;



        switch (evento.modalidade.toLowerCase()) {
          case "ufc": ufcDiv.appendChild(card); break;
          case "wwe": wweDiv.appendChild(card); break;
          case "pbr": pbrDiv.appendChild(card); break;
        }
      });
    });

    /*function mostrarResultados(modalidade, btn) {
      ['ufc', 'wwe', 'pbr'].forEach(id => {
        document.getElementById(id).style.display = id === modalidade ? 'block' : 'none';
      });
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }*/



  // MOSTRA CONTAINER CORRESPONDENTE E ESCONDE OS OUTROS (fruto da filtragem por modalidade)
    function mostrarResultados(modalidade, btn) {
  ['ufc', 'wwe', 'pbr'].forEach(id => {
    const container = document.getElementById(id);
    if (id === modalidade) {
      container.style.display = 'flex';

      // Verifica se h√° eventos dentro
      if (container.children.length === 0) {
        document.getElementById("mensagem-sem-resultados").style.display = "block";
      } else {
        document.getElementById("mensagem-sem-resultados").style.display = "none";
      }
    } else {
      container.style.display = 'none';
    }
  });

  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

    

// MOSTRA POPUP COM DETALHES DOS COMBATES (INCLUI VENCEDORES E DERROTADOS BEM COMO O M√âTODO DE VITORIA/DERROTA)
    function abrirResultados(nomeEvento) {
      const resultados = JSON.parse(localStorage.getItem("resultados")) || [];
      const evento = resultados.find(ev => ev.nomeEvento === nomeEvento);
      if (!evento) return;

      document.getElementById("tituloEvento").textContent = evento.nomeEvento;
      const container = document.getElementById("combatesContainer");
      container.innerHTML = "";


      //Os resultados s√£o subcards dentro dum card de cada evento e que se ajusta ao vencedor, nome do vencedor, nome do derrotado e o m√©todo de vit√≥ria/derrota.
      evento.combates.forEach(combate => {
        const card = document.createElement("div");
        card.className = "combate-card";
        card.innerHTML = `
          <img src="../images/${combate.imagem}" alt="${combate.vencedor}" />
          <p><strong>${combate.vencedor}</strong> venceu ${combate.derrotado}</p>
          <p><em>${combate.metodo}</em></p>
        `;
        container.appendChild(card);
      });

      document.getElementById("popupResultados").classList.remove("hidden");
    }

    function fecharPopup() {
      document.getElementById("popupResultados").classList.add("hidden");
    }

      //SIDEBAR
      const toggleBtn = document.getElementById('toggle-menu');
    const sidebar = document.getElementById('sidebar');
  
    toggleBtn.addEventListener('click', () => {
      sidebar.classList.toggle('active');
    });

    const closeBtn = document.getElementById('close-sidebar');

    closeBtn.addEventListener('click', () => {
      sidebar.classList.remove('active');
    });


    const links = document.querySelectorAll('.sidebar a');
      links.forEach(link => {
        link.addEventListener('click', () => {
        sidebar.classList.remove('active');
        });
      });


    //P√°gina de sele√ß√£o de eventos.
    function selecionarModalidade(modalidade) {
      localStorage.setItem("modalidadeSelecionada", modalidade);
    }

    function definirModalidade(modalidade) {
      localStorage.setItem("modalidadeSelecionada", modalidade);
    }


  </script>

<script>


  // SISTEMA DE COMENT√ÅRIOS
  let eventoAtualComentarios = "";
  
  // Abre o popup e mostra os coment√°rios
  function abrirComentarios(eventoCodificado) {
    const nomeEvento = decodeURIComponent(eventoCodificado);
    eventoAtualComentarios = nomeEvento;

    const user = JSON.parse(localStorage.getItem("userLogado")); 
    const comentarios = JSON.parse(localStorage.getItem("comentarios_evento_" + nomeEvento)) || [];
    const container = document.getElementById("lista-comentarios");
    container.innerHTML = "";


    if (comentarios.length === 0) {
      container.innerHTML = "<p style='color: #aaa;'>Ainda sem coment√°rios.</p>";
    } else {
      comentarios.forEach(c => {
        const div = document.createElement("div");
        const hasLiked = c.likedBy && c.likedBy.includes(user?.email);
        div.className = "comentario";
        div.innerHTML = `
          <strong>${c.nome}</strong> (${c.data})<br>${c.texto}
          <div class="like-section">
            <button class="like-btn" data-nome="${c.nome}" data-data="${c.data}" title="Gostei">üëç</button>
            <span class="like-count">${c.likes || 0}</span>
          </div>
        `;

        container.appendChild(div);
      });
    }
  
    document.getElementById("tituloComentarios").textContent = "Coment√°rios sobre " + nomeEvento;
    document.getElementById("popupComentarios").classList.remove("hidden");
  }
  
  // Fecha o popup
  function fecharComentarios() {
    document.getElementById("popupComentarios").classList.add("hidden");
    document.getElementById("novo-comentario").value = "";
  }
  
  // Publica novo coment√°rio
  function publicarComentario() {
    const texto = document.getElementById("novo-comentario").value.trim();
    if (!texto) return;
  
    const user = JSON.parse(localStorage.getItem("userLogado"));
    if (!user) {
      alert("Tens de estar logado para comentar.");
      return;
    }
  

    //Estrutura do objeto de um coment√°rio
    const novo = {
     nome: user.nome,
     texto,
     data: new Date().toLocaleDateString("pt-PT"),
     likes: 0,
     likedBy: []
    };


  
    const key = "comentarios_evento_" + eventoAtualComentarios;
    const comentarios = JSON.parse(localStorage.getItem(key)) || [];
    comentarios.push(novo); //Publica√ß√£o de um coment√°rio
    localStorage.setItem(key, JSON.stringify(comentarios));
  
    abrirComentarios(encodeURIComponent(eventoAtualComentarios)); // Reabre para atualizar
    document.getElementById("novo-comentario").value = "";
  }

  document.addEventListener("DOMContentLoaded", () => {
  const emojiBtn = document.getElementById("toggle-emoji");
  const emojiPopup = document.getElementById("emoji-popup");
  const textarea = document.getElementById("novo-comentario");

  if (emojiBtn && emojiPopup) {
    emojiBtn.addEventListener("click", (e) => {
      emojiPopup.classList.toggle("hidden");
    });

    emojiPopup.addEventListener("click", (e) => {
      if (e.target.tagName === "SPAN") {
        textarea.value += e.target.textContent;
        textarea.focus();
        emojiPopup.classList.add("hidden");
      }
    });

    // Fecha o popup se clicar fora
    document.addEventListener("click", (e) => {
      if (!emojiPopup.contains(e.target) && !emojiBtn.contains(e.target)) {
        emojiPopup.classList.add("hidden");
      }
    });
  }



  /*VERIFICAR SE UM COMENT√ÅRIO J√Å TEVE LIKE DE UM CERTO UTILIZADOR, GARANTINDO QUE 1 UTILIZADOR ESPECIFICO S√ì PODE DAR LIKE A 1 COMENT√ÅRIO ESPECIFICO*/
  document.getElementById("lista-comentarios").addEventListener("click", function(e) {
  if (e.target.classList.contains("like-btn")) {
    const nome = e.target.getAttribute("data-nome");
    const data = e.target.getAttribute("data-data");

    const key = "comentarios_evento_" + eventoAtualComentarios;
    const comentarios = JSON.parse(localStorage.getItem(key)) || [];

    const comentario = comentarios.find(c => c.nome === nome && c.data === data);
    const user = JSON.parse(localStorage.getItem("userLogado"));

    if (comentario && user) {
      if (!comentario.likedBy) comentario.likedBy = [];

      if (!comentario.likedBy.includes(user.email)) {
        comentario.likes = (comentario.likes || 0) + 1;
        comentario.likedBy.push(user.email);
        localStorage.setItem(key, JSON.stringify(comentarios));
        abrirComentarios(encodeURIComponent(eventoAtualComentarios)); // refresh
      } else {
        alert("J√° deste like a este coment√°rio!");
      }
    }
  }
});

});


  </script>
  
</body>
</html>
